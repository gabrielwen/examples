apiVersion: tekton.dev/v1alpha1
kind: Task
metadata:
  name: get-credentials
  namespace: gabrielwen
  annotations:
    sidecar.istio.io/inject: "false"
spec:
  steps:
  - name: git-checkout
    image: gcr.io/kubeflow-ci/test-worker-py3:789005d
    script: |
      #!/usr/bin/env bash
      /usr/local/bin/checkout_repos.sh \
      --repos=kubeflow/examples@master,kubeflow/testing@HEAD,kubeflow/tf-operator@HEAD \
      --src_dir=/mnt/test-data-volume/testing/src
    volumeMounts:
    - mountPath: /mnt/test-data-volume
      name: tekton-testing-pvc
  - name: get-credentials
    image: gcr.io/kubeflow-ci/test-worker:latest
    command: ["python3"]
    args: ["-m", "kubeflow.testing.get_kf_testing_cluster", "get-credentials"]
    env:
    - name: PYTHONPATH
      value: /mnt/test-data-volume/testing/src/kubeflow/examples/py:/mnt/test-data-volume/testing/src/kubeflow/testing/py:/mnt/test-data-volume/testing/src/kubeflow/tf-operator/py
    - name: GOOGLE_APPLICATION_CREDENTIALS
      value: /secrets/sa/kubflow-releasing.json
    volumeMounts:
    - mountPath: /mnt/test-data-volume
      name: tekton-testing-pvc
    - mountPath: /secrets/sa
      name: kubeflow-releasing-credential
  volumes:
  - name: tekton-testing-pvc
    persistentVolumeClaim:
      claimName: tekton-testing-pvc
      readOnly: false
  - name: kubeflow-releasing-credential
    secret:
      secretName: kubeflow-releasing
---
apiVersion: tekton.dev/v1alpha1
kind: TaskRun
metadata:
  name: get-credentials-run
  namespace: gabrielwen
spec:
  taskRef:
    name: get-credentials
